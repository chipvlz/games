(function(scope,$){var config=new scope.Config();var library=new scope.Lib();var typeBonus={Create:0,Run:1,Pause:2};var timeDefault=15;var totalOpen=10;var bonus=function(){this.type=typeBonus.Create;totalOpen=10;};bonus.prototype.start=function(data,callback){var that=this;that.type=typeBonus.Run;that.GetMainBonus(function(){});totalOpen=10;this.dataBonus=data;this.numberSelect=[];$('#bonusGameVptMoney .money_play').html('<i>Lượt mở còn lại:</i>'+totalOpen);$('#bonusGameVptMoney .money_win').html('<i>Thắng:</i>0');$('#vqhNumberXBonus').html('<strong>X'+this.dataBonus.StartBonus+'<span>X'+this.dataBonus.StartBonus+'</span></strong>');this.timesBonus=timeDefault;this.countTimeBonus(callback);};bonus.prototype.GetMainBonus=function(callback){var that=this;$.ajax({type:"GET",url:config.UrlRoot+'Home/BonusGame',success:function(data){$('#'+config.IdView.InGame.Canvas).hide();$('#vqhMinigame').html(data);$('#vqhMinigame').show();$("#playGameVptMoney").hide();$("#bonusGameVptMoney").show();$("#lineSelectedVqh").hide();$("#numberBonusVqh").show();$('#vqhMinigame .col_game span').unbind("click").bind("click",function(){that.selectGiftBonus(this);});if(typeof callback!='undefined'&&typeof callback=='function')
callback();},fail:function(){}});};bonus.prototype.renderSelect=function(){if(this.numberSelect.length<=0)
return;$('#vqhMessageIngameContent').html("");$('#vqhMessageIngame').hide();$('#vqhMessageIngame').unbind("click");var moneyWin=0;var data=this.dataBonus.GoldMinerData.split(";");for(var i=0;i<this.numberSelect.length;i++){var item=data[i].split(",");$(this.numberSelect[i]).removeAttr('class');if(item[1]==200||item[1]==201||item[1]==202||item[1]==203){$(this.numberSelect[i]).addClass('thung_ruongvang');$(this.numberSelect[i]).html('<i>+'+library.convertMoneyNumber(item[3])+'</i>');}else if(item[1]==210){$(this.numberSelect[i]).addClass('thung_chiakhoa');}else{$(this.numberSelect[i]).addClass('thung_tien');$(this.numberSelect[i]).html('<i>+'+library.convertMoneyNumber(item[3])+'</i>');}
moneyWin+=parseInt(item[3]);}
$('#bonusGameVptMoney .money_play').html('<i>Lượt mở còn lại:</i>'+totalOpen);$('#bonusGameVptMoney .money_win').html('<i>Thắng:</i>'+library.convertMoneyNumber(moneyWin));if(data[this.numberSelect.length-1].split(",")[1]==210)
$('#vqhNumberXBonus').html('<strong>X'+ +data[this.numberSelect.length-1].split(",")[2]+'<span>X'+ +data[this.numberSelect.length-1].split(",")[2]+'</span></strong>');if(data.length<=this.numberSelect.length){this.timesBonus=0;}else{this.timesBonus=timeDefault;}};bonus.prototype.selectGiftBonus=function(item){if($(item).attr("class")!=undefined&&$(item).attr("class").length>0){return;}
var that=this;var data=this.dataBonus.GoldMinerData;this.numberSelect.push(item);if(data!=null&&data.split(";").length>=10){if((this.numberSelect.length-1)<data.split(";").length){var itemSplit=data.split(";")[this.numberSelect.length-1].split(",");if(itemSplit[1]==200||itemSplit[1]==201||itemSplit[1]==202||itemSplit[1]==203){totalOpen=totalOpen-1;this.startSelectHu(itemSplit,function(){that.renderSelect(item,itemSplit);});}else{if(itemSplit[1]!=210){totalOpen=totalOpen-1;}
this.renderSelect(item,itemSplit);}}else
this.timesBonus=0;}};bonus.prototype.startSelectHu=function(dataItem,callback){var that=this;$.ajax({type:"GET",url:config.UrlRoot+"Home/RuongVang",success:function(data){$('#vqhMessageIngameContent').html(data);$('#vqhMessageIngame').show();$('#vqhMessageIngame').unbind("click");$(".add_luot").hide();$('#ruongvangVpt .pop_content a').unbind("click").bind("click",function(){selectClick(dataItem,this);});that.timesBonus+=100;},fail:function(){}});function selectClick(dataSelect,item){$("#ruongvangVpt").removeClass("popup_moruong").addClass("pop_nhanvang");$('#ruongvangVpt .pop_content a').unbind("click");$.each($("#ruongvangVpt .pop_content a"),function(key,value){if(value==item){$(value).html('<img src="'+
config.UrlRoot+
'images/MiniGames/RuongBauOpen.png" alt=""/> '+
library.convertMoneyNumber(dataSelect[3])+
'<span></span>');$(value).css("opacity","1")}else{var rd=Math.floor((Math.random()*10)-4);var valueRd=rd*config.Room.Value[vqsSlot.roomSelect]+parseInt(dataSelect[3]);if(valueRd<0)
valueRd=dataSelect[3];$(value).html('<img src="'+
config.UrlRoot+
'images/MiniGames/RuongBauOpen.png" alt=""/> '+
library.convertMoneyNumber(valueRd)+
'<span></span>');}});$("#ruongvangtxtContinues").html("Bấm để tiếp tục...");setTimeout(function(){$('#vqhMessageIngame').unbind("click").bind("click",function(){$('#vqhMessageIngameContent').html("");$('#vqhMessageIngame').hide();$('#vqhMessageIngame').unbind("click");$(".add_luot").show();if(typeof callback!='undefined'&&typeof callback=='function')
callback();});},1000);that.timesBonus=timeDefault;}
this.timesBonus=timeDefault;};bonus.prototype.countTimeBonus=function(callback){var that=this;countTime(callback);function countTime(cb){if(that.timesBonus<=0){that.end(cb);}else{$('#VptBonusCountDown').html('Hệ thống sẽ tự mở sau '+that.timesBonus+'s');that.timesBonus--;setTimeout(function(){countTime(cb);},1000);}}};bonus.prototype.end=function(callback){var that=this;$('#vqhMinigame .col_game span').unbind("click");this.type=typeBonus.Pause;vqsSlot.showStatus(1,'Bonus kết thúc. Bạn giành được <t style="color:#b12d0f;">'+library.convertMoneyNumber(this.dataBonus.PrizeValue)+' Vgold</t>',5,function(){closeBonus();},function(){closeBonus();},function(){closeBonus();});function closeBonus(){$('#vqhMinigame').html("");$('#vqhMinigame').hide();$('#'+config.IdView.InGame.Canvas).show();$("#playGameVptMoney").show();$("#bonusGameVptMoney").hide();$("#lineSelectedVqh").show();$("#numberBonusVqh").hide();$('#vqhMessageIngame').unbind("click");$('#vqhMessageIngameContent').html("");$('#vqhMessageIngame').hide();$(".add_luot").show();if(typeof callback!='undefined'&&typeof callback=='function')
callback();}};scope.BonusGame=bonus;})(window.vuongquocsao,$)