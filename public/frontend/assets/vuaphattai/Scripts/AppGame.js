(function(scope,$){var config=new scope.Config();var library=new scope.Lib();var item=new scope.ItemGame();var bonus=new scope.BonusGame();var audioInstance={};var gamelogic=function(){this.loadResources=new createjs.LoadQueue();createjs.Sound.alternateExtensions=["mp3"];this.loadResources.installPlugin(createjs.Sound);this.moneySelect=config.MoneyType.Star;this.roomSelect=config.Room.Lobby.Id;this.lineSelect=[1,2,3,4,5,6,7,8,9,10,11,12,14,13,15,16,17,18,19,20];this.isAutoSpin=false;this.TotalAutoSpin=0;this.stageCanvas=null;this.oldListItem=[];this.lineResult=null;this.isSpin=config.IsSpin.Finish;this.isFreeSpin=false;this.InfoFreeSpin={Count:0,TotalMoney:0};this.accountInfo=null;this.isMusic=false;this.isCreateMusic=false;this.SpriteSheetItem=null;this.IntevalWin=null;};gamelogic.prototype.init=function(){this.actionBtnId();this.initHub();};gamelogic.prototype.initHub=function(){this.hub=new scope.HubManager();this.hub.connectHub(function(){$('#vqs_loadding').hide();$('#'+config.IdView.Lobby.All).show();});};gamelogic.prototype.actionBtnId=function(){var that=this;this.actionBtnSelectRoom(true);$('#vqs_music_btn').unbind("click").bind("click",function(){onOffMusic();});$('#vqs_musicLobby_btn').unbind("click").bind("click",function(){onOffMusic();});function onOffMusic(){$('#vqs_music_btn').removeClass('vinhdanh-setting-btn');$('#vqs_music_btn').removeClass('vinhdanh-setting-btn-stopSound');$('#vqs_musicLobby_btn').removeClass('vinhdanh-setting-btn');$('#vqs_musicLobby_btn').removeClass('vinhdanh-setting-btn-stopSound');if(that.isMusic){$('#vqs_music_btn').addClass('vinhdanh-setting-btn-stopSound');$('#vqs_musicLobby_btn').addClass('vinhdanh-setting-btn-stopSound');that.isMusic=false;}else{$('#vqs_music_btn').addClass('vinhdanh-setting-btn');$('#vqs_musicLobby_btn').addClass('vinhdanh-setting-btn');that.isMusic=true;}}
this.isPopupGuide=false;$('.btn-thongtin').unbind("click").bind("click",function(){showHideGuide();});function showHideGuide(){$('.btn-thongtin').unbind("click");$.ajax({type:"GET",url:config.UrlRoot+'Home/BangThuongGuild?roomId='+vqsSlot.roomSelect,success:function(data){$("#vpt_popupInfo").html(data);$("#vpt_popupInfo").show();$('#closeBangThuongVpt').unbind("click").bind("click",function(){$("#vpt_popupInfo").hide();$("#vpt_popupInfo").html("");$('.btn-thongtin').unbind("click").bind("click",function(){showHideGuide();});});that.isPopupGuide=true;},fail:function(){console.log('loi nhe');}});}
$('.btn-lichsu').unbind("click").bind("click",function(){showHideHistory();});$('.option_lsgd').unbind("click").bind("click",function(){showHideHistory();});function showHideHistory(){Utils.showLoading();$.ajax({type:"GET",url:config.UrlRoot+'Home/GetAccountHistory',crossDomain:true,xhrFields:{withCredentials:true},success:function(data){$("#vpt_popupInfo").html(data);$("#vpt_popupInfo").show();$('.tab_LSHuSao').unbind("click").bind("click",function(){showVinhDanh();});$('#closePopupInfoVpt').unbind("click").bind("click",function(){$("#vpt_popupInfo").hide();$("#vpt_popupInfo").html("");});that.isPopupGuide=true;},fail:function(){console.log('loi nhe');}}).always(function(){Utils.hideLoading();});;}
$('.btn-vinhdanh').unbind("click").bind("click",function(){showVinhDanh();});$('.option_lsh').unbind("click").bind("click",function(){showVinhDanh();});function showVinhDanh(){Utils.showLoading();$.ajax({type:"GET",url:config.UrlRoot+'Home/GetJackpotHistory',success:function(data){$("#vpt_popupInfo").html(data);$("#vpt_popupInfo").show();$('.tab_LSGiaoDich').unbind("click").bind("click",function(){showHideHistory();});$('#closePopupInfoVpt').unbind("click").bind("click",function(){$("#vpt_popupInfo").hide();$("#vpt_popupInfo").html("");});that.isPopupGuide=true;},fail:function(){console.log('loi nhe');}}).always(function(){Utils.hideLoading();});}
vqsSlot.ShowBangThuong();setInterval(function(){vqsSlot.ShowBangThuong();},5000);$('#'+config.IdBtn.InGame.BackLobby).unbind("click").bind("click",function(){if($(".wrapper1").attr("class")!=undefined)$(".wrapper1").attr("class","wrapper");if($(".wrapper2").attr("class")!=undefined)$(".wrapper2").attr("class","wrapper");$(".main_game").css("display","none");that.loadLobby();});for(var i=1;i<21;i++){hoverLine(i);}
function hoverLine(line){$('#vqs_lineShow_'+line).hover(function(){vqsSlot.ShowLineWin(line);},function(){vqsSlot.HideLineWin(line);});}};gamelogic.prototype.ShowLineWin=function(lineId){$("#lineWinVqh").show();if(lineId<10){$(".line0"+lineId).addClass("active");}else{$(".line"+lineId).addClass("active");}};gamelogic.prototype.HideLineWin=function(lineId){$("#lineWinVqh").hide();if(lineId<10){$(".line0"+lineId).removeClass("active");}else{$(".line"+lineId).removeClass("active");}};gamelogic.prototype.hideAllLineWin=function(){for(var j=1;j<21;j++){$("#lineWinVqh").hide();if(j<10){$(".line0"+j).removeClass("active");}else{$(".line"+j).removeClass("active");}}};gamelogic.prototype.actionBtnSelectRoom=function(check){var that=this;if(check){$('#'+config.IdBtn.SelectRoom.ChoiThu).unbind("click").bind("click",function(){that.selectRoom(config.Room.ChoiThu.Id);$(".wrapper").attr("class","wrapper2");$(".main_game").removeClass("main_game_nongdan");$(".main_game").removeClass("main_game_quytoc");$(".main_game").removeClass("main_game_hoanggia");$(".main_game").addClass("main_game_hoanggia");$(".main_game").css("display","block");});$('#'+config.IdBtn.SelectRoom.NongDan).unbind("click").bind("click",function(){that.selectRoom(config.Room.NongDan.Id);$(".main_game").css("display","none");});$('#'+config.IdBtn.SelectRoom.QuyToc).unbind("click").bind("click",function(){that.selectRoom(config.Room.QuyToc.Id);$(".wrapper").attr("class","wrapper1");$(".main_game").removeClass("main_game_nongdan");$(".main_game").removeClass("main_game_quytoc");$(".main_game").removeClass("main_game_hoanggia");$(".main_game").addClass("main_game_quytoc");$(".main_game").css("display","block");});$('#'+config.IdBtn.SelectRoom.HoangGia).unbind("click").bind("click",function(){that.selectRoom(config.Room.HoangGia.Id);$(".wrapper").attr("class","wrapper2");$(".main_game").removeClass("main_game_nongdan");$(".main_game").removeClass("main_game_quytoc");$(".main_game").removeClass("main_game_hoanggia");$(".main_game").addClass("main_game_hoanggia");$(".main_game").css("display","block");});}else{$('#'+config.IdBtn.SelectRoom.ChoiThu).unbind("click");$('#'+config.IdBtn.SelectRoom.NongDan).unbind("click");$('#'+config.IdBtn.SelectRoom.QuyToc).unbind("click");$('#'+config.IdBtn.SelectRoom.HoangGia).unbind("click");}};gamelogic.prototype.loadResourcesGame=function(list,callback){this.loadResources.on("complete",function(){if(typeof callback!="undefined"&&typeof callback==="function")
callback();});this.loadResources.loadManifest(list);};gamelogic.prototype.getResourceItem=function(id){var gr=this.loadResources.getResult(id);if(gr){return gr;}else{console.log('Resources not already!!!',id);}};gamelogic.prototype.loadSound=function(manifest){var that=this;var queue=new createjs.LoadQueue();createjs.Sound.alternateExtensions=["mp3"];queue.installPlugin(createjs.Sound);queue.addEventListener("fileload",function(){});queue.addEventListener("complete",function(){});queue.loadManifest(manifest);}
gamelogic.prototype.runSpin=function(callback){vqsSlot.hideAllLineWin();this.isSpin=config.IsSpin.Start;this.lineResult=null;var that=this;if(this.roomSelect==config.Room.ChoiThu.Id){var rd=Math.floor((Math.random()*50)+1);var resultSpin=config.dataRandom[rd];if(resultSpin.SpinData.IsJackpot){resultSpin.SpinData.TotalPrizeValue=this.moneyFree*resultSpin.SpinData.TotalJackpot;}
this.resultSpin(resultSpin);return;}
var lineList=this.lineSelect[0];for(var i=1;i<this.lineSelect.length;i++){lineList+=','+this.lineSelect[i];}
if(this.isAutoSpin){this.hub.serverSpin(lineList,callback);if(this.TotalAutoSpin>0&&this.TotalAutoSpin<10000){this.TotalAutoSpin--;}
if(this.TotalAutoSpin<=0){this.TotalAutoSpin=0;this.isAutoSpin=false;}
var totalAutoSpin=library.convertMoneyNumber(this.TotalAutoSpin);if(this.TotalAutoSpin>10000){totalAutoSpin="VH";}
$("#numberAutoSpin").html("<span>"+totalAutoSpin+"</span>"+totalAutoSpin);}else{this.hub.serverSetAutoSpin(this.isAutoSpin,lineList,function(){that.hub.serverSpin(lineList,callback);});}};gamelogic.prototype.selectRoom=function(roomIdNew){if(!this.isCreateMusic){vqsSlot.loadSound(ConfigVQS.Resources.All);this.isCreateMusic=true;}
if(roomIdNew!=config.Room.ChoiThu.Id){if(!this.checkLogin())
return;}
vqsSlot.playSound("interface");$('#'+config.IdView.Lobby.All).hide();$('#'+config.IdView.InGame.Canvas).show();$("#topControlIngame").show();$("#controlIngame_Vqh").show();var jpValue='50.000.000';if(roomIdNew==config.Room.NongDan.Id){jpValue=$('#vqh_nongdan_jackpotValue').html();}
if(roomIdNew==config.Room.QuyToc.Id){jpValue=$('#vqh_quytoc_jackpotValue').html();}
if(roomIdNew==config.Room.HoangGia.Id){jpValue=$('#vqh_hoanggia_jackpotValue').html();}
$('#'+config.IdView.InGame.JackpotValue).html(jpValue);this.actionBtnSelectRoom(false);var that=this;var selectRoomId=roomIdNew;if(roomIdNew==config.Room.ChoiThu.Id){selectRoomId=config.Room.HoangGia.Id;}
if(!this.getResourceItem('item_'+selectRoomId)){$("#vqh_loading").show();$('.line_loading span').animate({'width':'366px'},500,function(){});var roomValue=config.Resources.Room3;if(roomIdNew==config.Room.NongDan.Id){roomValue=config.Resources.Room1;}
if(roomIdNew==config.Room.QuyToc.Id){roomValue=config.Resources.Room2;}
this.loadResourcesGame(roomValue,function(){$("#spanvqhLoading").css("width","100%");$("#vqh_loading").hide();vqsSlot.loadCanvas();nextSelectRoom(roomIdNew);});}else{nextSelectRoom(roomIdNew);}
function nextSelectRoom(roomId){vqsSlot.InitSpriteSheet(roomId);if(roomId==config.Room.NongDan.Id||roomId==config.Room.QuyToc.Id||roomId==config.Room.HoangGia.Id){if(roomId!=that.roomSelect)
that.hub.serverPlayNow(that.moneySelect,roomId,function(){});}else if(roomId==config.Room.ChoiThu.Id){that.roomSelect=roomId;that.loadRoom(roomId);}else{that.roomSelect=roomId;that.loadRoom(roomId);}}};gamelogic.prototype.InitSpriteSheet=function(roomId){if(roomId==config.Room.NongDan.Id){this.SpriteSheetItem=new createjs.SpriteSheet({"images":[vqsSlot.getResourceItem('item_1')],"frames":[[1,1,126,139,0,-7,0],[1,142,109,107,0,-17,-21],[112,142,109,105,0,-16,-29],[129,1,112,138,0,-12,0],[223,141,110,104,0,-18,-27],[243,1,121,133,0,-12,-7],[335,136,112,115,0,-12,-18],[366,1,110,126,0,-15,-13],[449,129,121,121,0,-12,-15],[478,1,109,121,0,-17,-13],[572,124,126,120,0,-7,-13],[700,1,110,118,0,-18,-19],[589,1,109,119,0,-16,-21],[700,121,110,113,0,-15,-21]],"animations":{"Icon_3S":{"frames":[0]},"Icon_6":{"frames":[1]},"Icon_5":{"frames":[2]},"Icon_4S":{"frames":[3]},"Icon_2":{"frames":[4]},"Icon_1S":{"frames":[5]},"Icon_4":{"frames":[6]},"Icon_7S":{"frames":[7]},"Icon_1":{"frames":[8]},"Icon_6S":{"frames":[9]},"Icon_3":{"frames":[10]},"Icon_2S":{"frames":[11]},"Icon_5S":{"frames":[12]},"Icon_7":{"frames":[13]}}});}
if(roomId==config.Room.QuyToc.Id){this.SpriteSheetItem=new createjs.SpriteSheet({"images":[vqsSlot.getResourceItem('item_2')],"frames":[[1,1,125,133,0,-6,-7],[1,136,125,120,0,-6,-15],[1,258,124,133,0,-9,-7],[1,393,124,120,0,-9,-15],[1,515,121,135,0,-12,-5],[1,652,121,123,0,-12,-13],[1,777,112,126,0,-8,-10],[1,905,112,112,0,-8,-18],[1,1019,111,130,0,-15,-10],[1,1151,111,127,0,-18,-7],[1,1280,111,113,0,-15,-18],[1,1395,111,113,0,-18,-15],[1,1510,104,129,0,-16,-4],[1,1641,102,140,0,-18,0]],"animations":{"Icon_4S":{"frames":[0]},"Icon_4":{"frames":[1]},"Icon_1S":{"frames":[2]},"Icon_1":{"frames":[3]},"Icon_2S":{"frames":[4]},"Icon_2":{"frames":[5]},"Icon_6S":{"frames":[6]},"Icon_6":{"frames":[7]},"Icon_5S":{"frames":[8]},"Icon_7S":{"frames":[9]},"Icon_5":{"frames":[10]},"Icon_7":{"frames":[11]},"Icon_3":{"frames":[12]},"Icon_3S":{"frames":[13]}}});}
if(roomId==config.Room.HoangGia.Id||roomId==config.Room.ChoiThu.Id){this.SpriteSheetItem=new createjs.SpriteSheet({"images":[vqsSlot.getResourceItem('item_3')],"frames":[[1,1,123,140,0,-8,0],[126,1,102,140,0,-20,0],[1,143,119,140,0,-11,0],[122,143,118,134,0,-11,-6],[122,279,116,134,0,-12,-6],[1,285,117,123,0,-11,-14],[1,410,118,121,0,-11,-14],[121,415,104,135,0,-18,-3],[1,533,107,127,0,-19,-13],[110,552,121,137,0,-10,-2],[1,662,92,134,0,-21,-6],[1,798,123,125,0,-8,-9],[126,691,108,113,0,-18,-21],[126,806,92,123,0,-21,-14]],"animations":{"Icon_4S":{"frames":[0]},"Icon_2S":{"frames":[1]},"Icon_3S":{"frames":[2]},"Icon_7S":{"frames":[3]},"Icon_1S":{"frames":[4]},"Icon_1":{"frames":[5]},"Icon_7":{"frames":[6]},"Icon_2":{"frames":[7]},"Icon_5S":{"frames":[8]},"Icon_3":{"frames":[9]},"Icon_6S":{"frames":[10]},"Icon_4":{"frames":[11]},"Icon_5":{"frames":[12]},"Icon_6":{"frames":[13]}}});}}
gamelogic.prototype.joinGame=function(player){if(this.roomSelect!=player.RoomID){var that=this;this.roomSelect=player.RoomID;this.loadRoom(player.RoomID,function(){if(player.SpinData.TotalFreeSpin>0){$(".Luotquay_mienphi").css("display","inline-block")
$(".Luotquay_mienphi").find("span").html(player.SpinData.TotalFreeSpin);that.lineSelect=[];var listLine=player.SpinData.Lines.split(",");for(var i=0;i<listLine.length;i++){that.lineSelect.push(parseInt(listLine[i]));}
that.numberLineSelect();vqsSlot.hideAllLineWin();that.freeSpin(player.SpinData.TotalFreeSpin,0);}
else if(player.SpinData.TotalVqSpin>0){$(".Luotquay_mienphi").css("display","inline-block")
$(".Luotquay_mienphi").find("span").html(player.SpinData.TotalVqSpin);that.lineSelect=[];var listLine=player.SpinData.Lines.split(",");for(var i=0;i<listLine.length;i++){that.lineSelect.push(parseInt(listLine[i]));}
that.numberLineSelect();vqsSlot.hideAllLineWin();that.freeSpin(player.SpinData.TotalVqSpin,0);}});}};gamelogic.prototype.loadRoom=function(roomId,callback){for(var i=0;i<5;i++){this.containerItem.getChildAt(i).removeAllChildren();}
this.oldListItem=[];for(var k=0;k<15;k++){this.oldListItem.push(Math.floor(Math.random()*7)+1);}
item.drawItem(0);$('#'+config.IdView.Lobby.All).hide();$('#vqs_loadding').hide();$('#'+config.IdView.InGame.All).show();for(var j=0;j<4;j++){if(j==roomId)
$('.'+config.IdView.InGame.ClassRoom+roomId).show();else
$('.'+config.IdView.InGame.ClassRoom+j).hide();}
$('#'+config.IdView.InGame.MainGame).removeClass(config.IdView.NongDan.Class);$('#'+config.IdView.InGame.MainGame).removeClass(config.IdView.QuyToc.Class);if(roomId==config.Room.NongDan.Id){$('#'+config.IdView.InGame.MainGame).addClass(config.IdView.NongDan.Class);}else if(roomId==config.Room.QuyToc.Id){$('#'+config.IdView.InGame.MainGame).addClass(config.IdView.QuyToc.Class);}
else{}
$('#'+config.IdView.RoomValue).html(library.convertMoneyNumber(config.Room.Value[roomId]));this.numberLineSelect();vqsSlot.hideAllLineWin();this.activeBtnSpin(true);if(roomId==config.Room.ChoiThu.Id)
this.activeBtnAutoSpin(false);else
this.activeBtnAutoSpin(true);$(".Name_ChoiThu").removeClass("active");$(".Name_NongDan").removeClass("active");$(".Name_QuyToc").removeClass("active");$(".Name_HoangGia").removeClass("active");var activeName="Name_ChoiThu";if(roomId==config.Room.NongDan.Id){activeName="Name_NongDan";}
if(roomId==config.Room.QuyToc.Id){activeName="Name_QuyToc";}
if(roomId==config.Room.HoangGia.Id){activeName="Name_HoangGia";}
$("."+activeName).addClass("active")
if(roomId==config.Room.ChoiThu.Id){this.lineSelectBtn(3);this.moneyChoiThu(config.RoomFree.Type.Start);vqsSlot.hideAllLineWin();}
$("#vqh_ingame_Money").html($("#headerRealCoinValue").html())
$('#'+config.IdView.InGame.PrizeValue).html(0);if(typeof callback!="undefined"&&typeof callback==="function")
callback();};gamelogic.prototype.loadLobby=function(){var that=this;if(this.isSpin!=config.IsSpin.Finish){this.showStatus(1,'Đang quay không thể rời phòng ',5);return;}
$(".main_game.main_game_quytoc").css("display","none");this.lineResult=null;for(var i=0;i<5;i++){this.containerItem.getChildAt(i).removeAllChildren();}
that.containerMoney=new createjs.Container();that.stageCanvas.addChild(this.containerItem,this.containerMoney);that.stageCanvas.update();$('#'+config.IdView.Lobby.All).show();$('#'+config.IdView.InGame.Canvas).hide();$("#topControlIngame").hide();$("#controlIngame_Vqh").hide();$(".Name_ChoiThu").removeClass("active");$(".Name_NongDan").removeClass("active");$(".Name_QuyToc").removeClass("active");$(".Name_HoangGia").removeClass("active");this.roomSelect=config.Room.Lobby.Id;this.actionBtnSelectRoom(true);};gamelogic.prototype.loadCanvas=function(){var that=this;if(that.stageCanvas!=null){return;}
var canvasimg=document.getElementById(config.IdView.InGame.Canvas);that.stageCanvas=new createjs.Stage(canvasimg);createjs.Ticker.framerate=30;createjs.Ticker.on("tick",function(e){if(that.roomSelect==config.Room.ChoiThu.Id||that.roomSelect==config.Room.NongDan.Id||that.roomSelect==config.Room.QuyToc.Id||that.roomSelect==config.Room.HoangGia.Id){if(vqsSlot.isSpin!=config.IsSpin.Finish){vqsSlot.UpdateCacheCanvas();}
that.stageCanvas.update();}});that.containerItem=new createjs.Container();that.containerItem.set({x:0,y:0,name:'containerItem'});for(var i=0;i<5;i++){var listItem=new createjs.Container();listItem.set({x:config.ContainerXY.X[i],y:config.ContainerXY.Y,name:'listItem'+i});that.containerItem.addChild(listItem);}
that.containerMoney=new createjs.Container();that.stageCanvas.addChild(this.containerItem,this.containerMoney);};gamelogic.prototype.UpdateCacheCanvas=function(){if(vqsSlot.containerItem!=null&&vqsSlot.containerItem.children.length>0){for(var i=0;i<vqsSlot.containerItem.children.length;i++){var container=vqsSlot.containerItem.children[i];if(container!=undefined&&container.children!=undefined&&container.children.length>0){for(var j=0;j<container.children.length;j++){var item=container.children[j];item.updateCache();}}}}}
gamelogic.prototype.resultSpin=function(result){this.isSpin=config.IsSpin.Run;this.total_freeSpin=result.SpinData.TotalFreeSpin+result.SpinData.TotalVqSpin;var that=this;item.runSpin(result.SpinData.SlotsData,function(){that.lineResult=result.SpinData.PrizesData;item.showLine(-1);if(result.SpinData.IsJackpot){that.playSound("NoJackpot");if(that.roomSelect!=config.Room.ChoiThu.Id){item.jackpot(result.SpinData.TotalPrizeValue,result.SpinData.TotalJackpot,nextJackpot);}else{item.jackpot(result.SpinData.TotalPrizeValue,result.SpinData.TotalJackpot,nextJackpot);}
function nextJackpot(){that.isAutoSpin=false;that.TotalAutoSpin=0;$("#numberAutoSpin").html("<span></span>");that.isSpin=config.IsSpin.Finish;if(that.roomSelect==config.Room.ChoiThu.Id)
that.activeBtnAutoSpin(false);else
that.activeBtnAutoSpin(true);that.activeBtnSpin(true);if(that.roomSelect==config.Room.ChoiThu.Id){that.moneyChoiThu(config.RoomFree.Type.Jackpot);}}}else{if(result.SpinData.TotalPrizeValue>=config.Room.Value[that.roomSelect]*100){that.playSound("superWin");item.bigSupperWin(result.SpinData.TotalPrizeValue,function(){checkBonus(result);});}else if(result.SpinData.TotalPrizeValue>=config.Room.Value[that.roomSelect]*80){that.playSound("bigWin");item.bigWin(result.SpinData.TotalPrizeValue,function(){checkBonus(result);});}else if(result.SpinData.TotalPrizeValue>0){that.playSound("normal_win");item.moneyWinBt(result.SpinData.TotalPrizeValue,function(){checkBonus(result);});}else{if(result.BonusGame.GoldMinerData.length<1){that.playSound("lose_dd");$("#vqh_moneyBet_Win").html("<i>Thắng:</i> 0");}
checkBonus(result);}}});function checkBonus(dataBonus){if(dataBonus.BonusGame.GoldMinerData!=null&&dataBonus.BonusGame.GoldMinerData.length>1&&dataBonus.BonusGame.PrizeValue>0){item.startBonus(function(){bonus.start(dataBonus.BonusGame,function(){if(that.roomSelect!=config.Room.ChoiThu.Id)
vqsSlot.hub.serverFinishBonusGame();checkFreeSpin(dataBonus);});});}else{checkFreeSpin(dataBonus);}}
function checkFreeSpin(data){if(that.roomSelect==config.Room.ChoiThu.Id){that.moneyChoiThu(config.RoomFree.Type.Spin);}
that.updateBalance(data.SpinData.Balance);$('#'+config.IdView.InGame.PrizeValue).html(library.convertMoneyNumber(data.SpinData.TotalPrizeValue));if(data.SpinData.IsFreeSpin&&data.SpinData.TotalFreeSpin>0){var currFreeSpin=parseInt($(".Luotquay_mienphi").find("span").html());if(data.SpinData.TotalFreeSpin>currFreeSpin){that.isFreeSpin=false;}
that.freeSpin(data.SpinData.TotalFreeSpin,data.SpinData.TotalPrizeValue);$(".Luotquay_mienphi").css("display","inline-block")
$(".Luotquay_mienphi").find("span").html(result.SpinData.TotalFreeSpin);}
else if(data.SpinData.TotalVqSpin>0){that.freeSpin(data.SpinData.TotalVqSpin,data.SpinData.TotalPrizeValue);$(".Luotquay_mienphi").css("display","inline-block")
$(".Luotquay_mienphi").find("span").html(result.SpinData.TotalVqSpin);}
else{$(".Luotquay_mienphi").css("display","none")
$(".Luotquay_mienphi").find("span").html("0");if(that.isFreeSpin){that.InfoFreeSpin.Count+=1;that.InfoFreeSpin.TotalMoney+=data.SpinData.TotalPrizeValue;$.ajax({type:"GET",url:config.UrlRoot+"Home/FreeSpinComplete?freeSpin="+that.InfoFreeSpin.Count+"&totalMoney="+that.InfoFreeSpin.TotalMoney,success:function(data){$('#vqhMessageIngameContent').html(data);$('#vqhMessageIngame').show();},fail:function(){}});that.timeoutMessageIngame=setTimeout(function(){$('#vqhMessageIngameContent').html("");$('#vqhMessageIngame').hide();$('#vqhMessageIngame').unbind("click");nextSpin();},5000);$('#vqhMessageIngame').unbind("click").bind("click",function(){$('#vqhMessageIngameContent').html("");$('#vqhMessageIngame').hide();$('#vqhMessageIngame').unbind("click");clearTimeout(that.timeoutMessageIngame);nextSpin();});that.isFreeSpin=false;that.InfoFreeSpin.Count=0;that.InfoFreeSpin.TotalMoney=0;}else{nextSpin();}}}
function nextSpin(){if(that.isAutoSpin){if(that.roomSelect==config.Room.ChoiThu.Id)
that.activeBtnAutoSpin(false);else
that.activeBtnAutoSpin(true);that.runSpin(function(){});}else{that.isSpin=config.IsSpin.Finish;if(that.roomSelect==config.Room.ChoiThu.Id)
that.activeBtnAutoSpin(false);else
that.activeBtnAutoSpin(true);that.activeBtnSpin(true);}}};gamelogic.prototype.freeSpin=function(total,moneyWin){this.activeBtnAutoSpin(false);this.activeBtnSpin(false);var that=this;if(this.isFreeSpin){this.InfoFreeSpin.Count+=1;this.InfoFreeSpin.TotalMoney+=moneyWin;this.runSpin(function(){});}else{this.isFreeSpin=true;this.playSound('freespin');$.ajax({type:"GET",url:config.UrlRoot+"Home/FreeSpin?freeSpin="+total,success:function(data){$('#vqhMessageIngameContent').html(data);$('#vqhMessageIngame').show();},fail:function(){}});that.timeoutMessageFreeSpinFinish=setTimeout(function(){$('#vqhMessageIngameContent').html("");$('#vqhMessageIngame').hide();$('#vqhMessageIngame').unbind("click");clearTimeout(that.timeoutMessageFreeSpinFinish);that.runSpin(function(){});},3000);$('#vqhMessageIngame').unbind("click").bind("click",function(){$('#vqhMessageIngameContent').html("");$('#vqhMessageIngame').hide();$('#vqhMessageIngame').unbind("click");clearTimeout(that.timeoutMessageFreeSpinFinish);that.runSpin(function(){});});}};gamelogic.prototype.activeBtnSpin=function(check){var that=this;$('#'+config.IdBtn.InGame.Spin).removeClass('active');$('#vqh_btn_stopSpin').removeClass('active');if(check){$('#'+config.IdBtn.InGame.Spin).addClass('active');$('#'+config.IdBtn.InGame.Spin).unbind("click").bind("click",function(){if(that.lineSelect.length<1){that.showStatus(0,'Bạn chưa chọn dòng');return;}
that.activeBtnSpin(false);that.activeBtnAutoSpin(false);that.runSpin(function(){});});}else{$('#vqh_btn_stopSpin').addClass('active');$("#vqh_btn_stopSpin img").attr("src",config.UrlRoot+"images/Button/bt_QuayD.png");}};gamelogic.prototype.activeBtnAutoSpin=function(check){};gamelogic.prototype.AutoSpinBtn=function(totalSpin){vqsSlot.TotalAutoSpin=totalSpin;vqsSlot.isAutoSpin=true;var totalAutoSpin=library.convertMoneyNumber(totalSpin);if(totalSpin>10000){totalAutoSpin="VH";}
$("#numberAutoSpin").html("<span>"+totalAutoSpin+"</span>"+totalAutoSpin);vqsSlot.OpenCloseAutoSpin();if(vqsSlot.isSpin==config.IsSpin.Finish){vqsSlot.runSpin(function(){});vqsSlot.activeBtnSpin(false);$("#vqh_btn_stopSpin img").attr("src",config.UrlRoot+"images/Button/bt_quayStop.png");$("#vqh_btn_stopSpin").unbind("click").bind("click",function(){$("#vqh_btn_stopSpin img").attr("src",config.UrlRoot+"images/Button/bt_QuayD.png");$("#vqh_btn_stopSpin").unbind("click");$("#numberAutoSpin").html("<span></span>");vqsSlot.TotalAutoSpin=0;vqsSlot.isAutoSpin=false;});}};gamelogic.prototype.OpenCloseAutoSpin=function(htmlItem){if($(window).width()>1600){if($(htmlItem).hasClass('hide')){$('.tuquay .add_luot').stop(true,true).animate({'top':'577px'});$('.add_luot_numb').stop(true,true).animate({'height':'182px'});$(htmlItem).removeClass('hide');}else{$('.tuquay .add_luot').stop(true,true).animate({'top':'760px'});$('.add_luot_numb').stop(true,true).animate({'height':'0px'});$(htmlItem).addClass('hide');}}else{if($(window).width()>1366){if($(htmlItem).hasClass('hide')){$('.tuquay .add_luot').stop(true,true).animate({'top':'480px'});$('.add_luot_numb').stop(true,true).animate({'height':'182px'});$(htmlItem).removeClass('hide');}else{$('.tuquay .add_luot').stop(true,true).animate({'top':'620px'});$('.add_luot_numb').stop(true,true).animate({'height':'0px'});$(htmlItem).addClass('hide');}}else{if($(htmlItem).hasClass('hide')){$('.tuquay .add_luot').stop(true,true).animate({'top':'344px'});$('.add_luot_numb').stop(true,true).animate({'height':'182px'});$(htmlItem).removeClass('hide');}else{$('.tuquay .add_luot').stop(true,true).animate({'top':'526px'});$('.add_luot_numb').stop(true,true).animate({'height':'0px'});$(htmlItem).addClass('hide');}}}};gamelogic.prototype.updateClientJackpot=function(result){var options={useEasing:true,useGrouping:true,separator:'.',decimal:','};var moneyOld3=$('#vqh_nongdan_jackpotValue').html();moneyOld3=parseInt(moneyOld3.replace(/\./g,''));if(moneyOld3!=parseInt(result.split('|')[0])){var count3=new CountUpNumber($("#vqh_nongdan_jackpotValue"),moneyOld3,parseInt(result.split('|')[0]),0,1,options,function(jp){$("#vqh_nongdan_jackpotValue").html(library.convertMoneyNumber(jp));});count3.start();}
var moneyOld2=$('#vqh_quytoc_jackpotValue').html();moneyOld2=parseInt(moneyOld2.replace(/\./g,''));if(moneyOld2!=parseInt(result.split('|')[1])){var count2=new CountUpNumber($("#vqh_quytoc_jackpotValue"),moneyOld2,parseInt(result.split('|')[1]),0,1,options,function(jp){$("#vqh_quytoc_jackpotValue").html(library.convertMoneyNumber(jp));});count2.start();}
var moneyOld1=$('#vqh_hoanggia_jackpotValue').html();moneyOld1=parseInt(moneyOld1.replace(/\./g,''));if(moneyOld1!=parseInt(result.split('|')[2])){var count1=new CountUpNumber($("#vqh_hoanggia_jackpotValue"),moneyOld1,parseInt(result.split('|')[2]),0,1,options,function(jp){$("#vqh_hoanggia_jackpotValue").html(library.convertMoneyNumber(jp));});count1.start();}
if(this.roomSelect==config.Room.NongDan.Id||this.roomSelect==config.Room.QuyToc.Id||this.roomSelect==config.Room.HoangGia.Id){var moneyOld0=$('#'+config.IdView.InGame.JackpotValue).html();moneyOld0=parseInt(moneyOld0.replace(/\./g,''));if(moneyOld0!=parseInt(result.split('|')[this.roomSelect-1])){var count0=new CountUpNumber($('#'+config.IdView.InGame.JackpotValue),moneyOld0,parseInt(result.split('|')[this.roomSelect-1]),0,1,options,function(jp){$('#'+config.IdView.InGame.JackpotValue).html(library.convertMoneyNumber(jp));});count0.start();}}};gamelogic.prototype.moneyChoiThu=function(type){if(type==config.RoomFree.Type.Start){this.moneyFree=config.RoomFree.MoneyStart;$('#'+config.IdView.InGame.JackpotValue).html(library.convertMoneyNumber(this.moneyFree));}else{var options={useEasing:true,useGrouping:true,separator:'.',decimal:','};var moneyOld=this.moneyFree;if(type==config.RoomFree.Type.Spin)
this.moneyFree+=config.RoomFree.MoneyAdd;else
this.moneyFree=config.RoomFree.MoneyStart;var count0=new CountUpNumber($('#'+config.IdView.InGame.JackpotValue),moneyOld,this.moneyFree,0,1,options,function(jp){$('#'+config.IdView.InGame.JackpotValue).html(library.convertMoneyNumber(jp));});count0.start();}};gamelogic.prototype.selectLine=function(number){if(this.isSpin!=config.IsSpin.Finish){this.showStatus(1,'Đang quay không thể chọn dòng ',5);return;}
if(this.roomSelect==config.Room.ChoiThu.Id){this.showStatus(1,'Chơi thử không thể chọn dòng ',5);return;}
if(this.roomSelect==config.Room.Lobby.Id){this.showStatus(1,'Hãy vào phòng để chọn dòng ',5);return;}
var listNew=[];var check=false;for(var i=0;i<this.lineSelect.length;i++){if(number!=this.lineSelect[i])
listNew.push(this.lineSelect[i]);else
check=true;}
if(!check){listNew.push(number);}
this.lineSelect=listNew;this.numberLineSelect();};gamelogic.prototype.lineSelectBtn=function(type){if(this.isSpin!=config.IsSpin.Finish){this.showStatus(1,'Đang quay không thể chọn dòng ',5);return;}
if(this.roomSelect==config.Room.Lobby.Id){this.showStatus(1,'Hãy vào phòng để chọn dòng ',5);return;}
this.playSound("interface");if(this.roomSelect==config.Room.ChoiThu.Id){type=3;}
if(type==1){this.lineSelect=[1,3,5,7,9,11,13,15,17,19];}else if(type==2){this.lineSelect=[2,4,6,8,10,12,14,16,18,20];}else if(type==3){this.lineSelect=[1,2,3,4,5,6,7,8,9,10,11,12,14,13,15,16,17,18,19,20];}else if(type==4){this.lineSelect=[];}
vqsSlot.SetLineSelected();this.numberLineSelect();};gamelogic.prototype.numberLineSelect=function(){$('#vqhnumber_lineSelected').html("<strong>"+this.lineSelect.length+"<span>"+this.lineSelect.length+"</span></strong>");$('#vqh_moneyBet_total').html('<i>Cược: </i>'+library.convertMoneyNumber(this.lineSelect.length*config.Room.Value[this.roomSelect]));if(this.roomSelect==config.Room.ChoiThu.Id){return;}
vqsSlot.SetLineSelected();};gamelogic.prototype.SetLineSelected=function(){$(".list_dong span").addClass("no_active");for(var i=0;i<this.lineSelect.length;i++){if(this.lineSelect[i]>=10){$(".list_dong .dong"+this.lineSelect[i]).removeClass("no_active");}else{$(".list_dong .dong0"+this.lineSelect[i]).removeClass("no_active");}}};gamelogic.prototype.messageSpin=function(msg,time){this.isAutoSpin=false;$("#numberAutoSpin").html("<span></span>");this.isSpin=config.IsSpin.Finish;this.activeBtnAutoSpin(true);this.activeBtnSpin(true);this.showStatus(1,msg,time);};gamelogic.prototype.showStatus=function(type,msg,time,cbYes,cbClose,cbTime){var that=this;$('#'+config.Status.All).fadeIn(500);$('#'+config.Status.Text).html(msg);$('#'+config.Status.BtnClose).unbind("click").bind("click",function(){if(that.timeStatus)
clearTimeout(that.timeStatus);$('#'+config.Status.All).hide();if(typeof cbClose!='undefined'&&typeof cbClose=='function')
cbClose();});$('#'+config.Status.BtnYes).unbind("click").bind("click",function(){if(that.timeStatus)
clearTimeout(that.timeStatus);$('#'+config.Status.All).hide();if(typeof cbYes!='undefined'&&typeof cbYes=='function')
cbYes();});if(type==1){if(this.timeStatus)
clearTimeout(this.timeStatus);this.timeStatus=setTimeout(function(){$('#'+config.Status.All).hide();if(typeof cbTime!='undefined'&&typeof cbTime=='function')
cbTime();},time*1000);}else if(type==2){if(this.timeStatus)
clearTimeout(this.timeStatus);$('#'+config.Status.All).hide();}};gamelogic.prototype.resultSpinBonus=function(result){this.updateBalance(result.SpinData.Balance);};gamelogic.prototype.updateBalance=function(money){if(this.roomSelect!=config.Room.ChoiThu.Id){$("#vqh_ingame_Money").html(library.convertMoneyNumber(money))
if(typeof GlobalHeader!='undefined'&&typeof GlobalHeader.UpdateRealCoinBalance=='function')
GlobalHeader.UpdateRealCoinBalance(money);}};gamelogic.prototype.checkLogin=function(){if(this.accountInfo&&this.accountInfo.Id>0){return true;}else{if(typeof GlobalHeader!='undefined'&&typeof GlobalHeader.ShowLoginPopup=='function')
GlobalHeader.ShowLoginPopup(1);return false;}};gamelogic.prototype.playSound=function(audioFileId,volume,loop,stopAudio){var that=this;function onOffMusic(){$('#vqs_music_btn').removeClass('vinhdanh-setting-btn');$('#vqs_music_btn').removeClass('vinhdanh-setting-btn-stopSound');$('#vqs_musicLobby_btn').removeClass('vinhdanh-setting-btn');$('#vqs_musicLobby_btn').removeClass('vinhdanh-setting-btn-stopSound');if(that.isMusic){$('#vqs_music_btn').addClass('vinhdanh-setting-btn-stopSound');$('#vqs_musicLobby_btn').addClass('vinhdanh-setting-btn-stopSound');that.isMusic=false;}else{$('#vqs_music_btn').addClass('vinhdanh-setting-btn');$('#vqs_musicLobby_btn').addClass('vinhdanh-setting-btn');that.isMusic=true;}}
if($('.main_option .inner a.sound').find('span').hasClass('turn_off')){volume=0;}
else{volume=1;}
if(!this.isMusic)
onOffMusic();if(stopAudio){createjs.Sound.stop();}
if(volume==undefined)
volume=1;if(!loop)
loop=0;createjs.Sound.volume=volume;audioInstance=createjs.Sound.play(audioFileId,{interrupt:createjs.Sound.INTERRUPT_ANY,loop:loop});if(audioInstance.playState=="playFailed"){setTimeout(function(){that.playSound(audioFileId,volume,loop);},1000);}
if(typeof navigator.vibrate=='function')
navigator.vibrate(300);else if(typeof navigator.mozVibrate=='function')
navigator.mozVibrate(300);else if(typeof navigator.webkitVibrate=='function')
navigator.webkitVibrate(300);};gamelogic.prototype.renderInfo=function(accountId,accountName){this.accountInfo={Id:accountId,Name:accountName};};gamelogic.prototype.playerWinJackpot=function(roomId1,name1,value1){setTimeout(function(){delayJackpot(roomId1,name1,value1);},5000);function delayJackpot(roomId,name,value){if(roomId==config.Room.NongDan.Id){$('#vqs_lobby_tableJackpot').children().eq(4).hide();$('#vqs_lobby_tableJackpot').children().eq(5).show();$('#vqs_lobby_tableJackpot').children().eq(5).html('<p>CHÚC MỪNG '+name+' ĐÃ NỔ HŨ '+library.convertMoneyNumber(value)+'</p>');setTimeout(function(){$('#vqs_lobby_tableJackpot').children().eq(5).hide();$('#vqs_lobby_tableJackpot').children().eq(4).show();},5000);}else if(roomId==config.Room.QuyToc.Id){$('#vqs_lobby_tableJackpot').children().eq(2).hide();$('#vqs_lobby_tableJackpot').children().eq(3).show();$('#vqs_lobby_tableJackpot').children().eq(3).html('<p>CHÚC MỪNG '+name+' ĐÃ NỔ HŨ '+library.convertMoneyNumber(value)+'</p>');setTimeout(function(){$('#vqs_lobby_tableJackpot').children().eq(3).hide();$('#vqs_lobby_tableJackpot').children().eq(2).show();},5000);}else{$('#vqs_lobby_tableJackpot').children().eq(0).hide();$('#vqs_lobby_tableJackpot').children().eq(1).show();$('#vqs_lobby_tableJackpot').children().eq(1).html('<p>CHÚC MỪNG '+name+' ĐÃ NỔ HŨ '+library.convertMoneyNumber(value)+'</p>');setTimeout(function(){$('#vqs_lobby_tableJackpot').children().eq(1).hide();$('#vqs_lobby_tableJackpot').children().eq(0).show();},5000);}}};gamelogic.prototype.reconnectServer=function(){};gamelogic.prototype.startLoadding=function(){};gamelogic.prototype.ShowBangThuong=function(){if(!$("#vinhDanhContentVpt").is(":visible")){return;}
$.ajax({type:"GET",url:config.UrlRoot+'Home/GetBigWinHistory',success:function(data){$("#vinhDanhContentVpt_Nd").html(data);$("#vinhDanhContentVpt").mCustomScrollbar();},fail:function(){console.log('loi nhe');}});};scope.vqsObj=gamelogic;})(window.vuongquocsao,$);var vqsSlot=vqsSlot||{};