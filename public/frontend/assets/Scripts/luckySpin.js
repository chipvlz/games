var spinLucky=new function(){this.count=6;this.playSpinlucky=function(){var verify=$("#headerCaptchaVerify").val();var captchaText=$("#answerVqMMCaptcha").val();if(captchaText==''){return;}
else{$.ajax({type:"GET",url:configHeader.urlConfig.eventUrl+'api/VongQuayMayManApi/GetResultSpinVQMMCap?captchaText='+captchaText+'&verify='+verify,cache:false,crossDomain:true,xhrFields:{withCredentials:true},success:function(response){if(response){if(response.ResponseStatus>0){$("#CurLuckySpin").html(response.TotalSpinLeft);$(".vqmm-cotsang").css("display","block");spinLucky.closeCaptcha();var RD1=response.PrizeStarId;var RD2=response.VipPointId;var positOut=-1;var positIn=-1;var name1='';var name2='';var value1=0;var value2=0;$.each(spinLucky.ConfigSpin.Gold,function(k,v){if(spinLucky.ConfigSpin.Gold[k].id==RD1){positOut=spinLucky.ConfigSpin.Gold[k].position;name1=spinLucky.ConfigSpin.Gold[k].name;value1=spinLucky.ConfigSpin.Gold[k].val;}});$.each(spinLucky.ConfigSpin.Coin,function(key,value){if(spinLucky.ConfigSpin.Coin[key].id==RD2){positIn=spinLucky.ConfigSpin.Coin[key].position;name2=spinLucky.ConfigSpin.Coin[key].name;value2=spinLucky.ConfigSpin.Coin[key].val;}});quay1=positOut*30;quay2=positIn*30;$('#vong-ngoai').animate({rotate:spinLucky.count*360+quay1},5000);$('#vong-trong').animate({rotate:-(spinLucky.count*360+quay2)},5000);spinLucky.count=spinLucky.count+6;setTimeout(function(){$("#vqmmPrizeVgold").html(Utils.formatMoney(value1)+"&nbsp;&nbsp;&nbsp;&nbsp;");if(RD2>=9){if(RD2==9||RD2==10){$("#vqmmIconXu").hide();$("#vqmmIconVpt").show();$("#vqmmIconAvenger").hide();}
if(RD2==11||RD2==12){$("#vqmmIconXu").hide();$("#vqmmIconVpt").hide();$("#vqmmIconAvenger").show();}
$("#vqmmPrizeXu").html(Utils.formatMoney(value2)+" lượt quay&nbsp;&nbsp;&nbsp;&nbsp;");}else{$("#vqmmPrizeXu").html(Utils.formatMoney(value2)+"&nbsp;&nbsp;&nbsp;&nbsp;");$("#vqmmIconXu").show();$("#vqmmIconVpt").hide();$("#vqmmIconAvenger").hide();}
$(".vqmm .vqmm-doithuong").css("display","block");},5000)}
else{if(response.ResponseStatus==-203){spinLucky.ShowCaptchaSpinLucky();}
else{$("#tb_lucky_spin").html("lỗi-xin thử lại sau!");}
return;}}}});}}
this.ShowCaptchaSpinLucky=function(){if(parseInt($("#CurLuckySpin").html())>0){$(".vqmm .vqmm-doithuong").css("display","none");var html='';html+='<div class="vqmm_alert">';html+='<div class="alert">';html+='<span onclick="spinLucky.closeCaptcha()" class="close_pop"><img src="Contents/images/ico-close.png" alt=""/></span>';html+='<div class="name_head"><img src="Contents/images/PNG.Khung/Text_VQMM.png" alt=""/></div>';html+='<p id="tb_lucky_spin">Vui lòng trả lời câu hỏi sau để vào VQMM</p>';html+='<p><span class="question"><img src="" id="headerCaptchaImg" alt=""/><input type="hidden" id="headerCaptchaVerify" value=""></span> =<input class="answer" id="answerVqMMCaptcha" type="text" /></p>';html+='<a href="javascript:;" onclick="spinLucky.playSpinlucky()"><img src="Contents/images/PNG.Khung/bt_HoanTat.png" alt=""/></a>';html+='</div>';html+='</div>	';$("#popupCaptchaSpin").html(html);setTimeout(function(){$.ajax({type:"GET",url:configHeader.urlConfig.eventUrl+'api/Captcha/GetMath',cache:false,crossDomain:true,xhrFields:{withCredentials:true},success:function(response){if(response){$("#answerVqMMCaptcha").keypress(function(e){if(e.keyCode==13){spinLucky.playSpinlucky();}});$("#headerCaptchaImg").attr("src","data:image/jpeg;base64,"+response[1]+"");$("#headerCaptchaVerify").val(response[0]);}}});},150);}
else{spinLucky.ShowMessageLeve2("bạn đã hết lượt quay.")}}
this.RefreshCaptchaMath=function(){$.ajax({type:"GET",url:configHeader.urlConfig.eventUrl+'api/Captcha/GetMath',success:function(response){if(response){$("#headerCaptchaImg").attr("src","data:image/jpeg;base64,"+response[1]+"");$("#headerCaptchaVerify").val(response[0]);}}});}
this.ShowMessageLeve2=function(text){$(".vqmm .vqmm-doithuong").css("display","none");var html='';html+='<div class="blackscreen2" id="headerOverlayPopupLevel2" style="">></div>';html+='<div class="vqmm_alert">';html+='<div class="alert">';html+='<span onclick="spinLucky.closeCaptcha()" class="close_pop"><img src="Contents/images/ico-close.png" alt=""/></span>';html+='<div class="name_head"><img src="Contents/images/PNG.Khung/Text_VQMM.png" alt=""/></div>';html+='<p id="tb_lucky_spin">'+text+'</p>';html+='</div>';html+='</div>	';$("#popupCaptchaSpin").html(html);setTimeout(function(){$.ajax({type:"GET",url:configHeader.urlConfig.eventUrl+'api/Captcha/GetMath',cache:false,crossDomain:true,xhrFields:{withCredentials:true},success:function(response){if(response){$("#headerCaptchaImg").attr("src","data:image/jpeg;base64,"+response[1]+"");$("#headerCaptchaVerify").val(response[0]);}}});},150)}
this.getCurrentSpin=function(isFirst){if(isFirst==undefined){isFirst=0}
else{isFirst=1;}
$.ajax({type:"GET",url:configHeader.urlConfig.eventUrl+'api/VongQuayMayManApi/GetSpinLeftVQMM',cache:false,crossDomain:true,xhrFields:{withCredentials:true},success:function(response){if(response){if(response.TotalSpinLeft>0){$("#CurLuckySpin").html(response.TotalSpinLeft);$("#CurLuckySpin").css("display","block");GlobalHeader.ShowLuckySpin();}}}});}
this.ShowRanking=function(){var that=this;showPopupData("LuckySpin/pRanking",1,0,function(){that.BindRankingList(1,15);});}
this.BindRankingList=function(currPage,recordPerPage){getAjaxInfo(configHeader.urlConfig.eventUrl+"api/VongQuayMayManApi/GetRankingVQMMPage?page="+currPage+"&recordPerPage="+recordPerPage,function(data){if(data!=undefined&&data.Data){var html=""
$.each(data.Data,function(key,val){html+='<tr><td>'+val.AccountName+'</td>';html+='<td>'+Utils.formatMoney(val.StarValue)+' Vgold</td>';if(val.VipPointId>=9){if(val.VipPointId==9){html+='    <td>'+val.VipPoint+' lượt quay Vua Phát Tài</td>';}else if(val.VipPointId==10){html+='    <td>'+val.VipPoint+' lượt quay Vua Phát Tài</td>';}else if(val.VipPointId==11){html+='    <td>'+val.VipPoint+' lượt quay Avenger</td>';}else if(val.VipPointId==12){html+='    <td>'+val.VipPoint+' lượt quay Avenger</td>';}}else{html+='    <td>'+Utils.formatMoney(val.VipPoint)+' Xu</td>';}
html+='<td>'+new Date(val.CreateDate).yyyymmddHHmmss()+'</td>';html+='</tr>';});$("#headerRankingHistoryVqmm").html(html);var page=data.TotalRecord/recordPerPage;if(data.TotalRecord%recordPerPage>0){page+=1;}
$('#headerRankingPagingVqmm').pager({pagenumber:currPage,pagecount:page,buttonClickCallback:function(page){spinLucky.BindRankingList(page,15);}});}});}
this.ShowHistoryLuckySpin=function(){var that=this;showPopupData("LuckySpin/pHistoryLuckySpin",1,0,function(){that.BindHistoryLuckySpinList(1,15);});}
this.BindHistoryLuckySpinList=function(currPage,recordPerPage){getAjaxInfo(configHeader.urlConfig.eventUrl+"api/VongQuayMayManApi/GetHistoryVQMMPage?page="+currPage+"&recordPerPage="+recordPerPage,function(respon){var TotalRecord=respon.TotalRecord;var data=respon.Data;if(data!=undefined&&respon.TotalRecord>0){var html=""
$.each(data,function(key,val){html+='<tr>'+
'    <td>'+new Date(val.CreatedTime).yyyymmddHHmmss()+'</td>'+
'    <td>'+Utils.formatMoney(val.PrizeValue)+' Vgold</td>';if(val.VipPointId>=9){if(val.VipPointId==9){html+='    <td>'+val.VipPointValue+' lượt quay Vua Phát Tài</td>';}else if(val.VipPointId==10){html+='    <td>'+val.VipPointValue+' lượt quay Vua Phát Tài</td>';}else if(val.VipPointId==11){html+='    <td>'+val.VipPointValue+' lượt quay Avenger</td>';}else if(val.VipPointId==12){html+='    <td>'+val.VipPointValue+' lượt quay Avenger</td>';}}else{html+='    <td>'+Utils.formatMoney(val.VipPointValue)+' Xu</td>';}
html+='</tr>';});$("#headerHistoryVqmm").html(html);var page=TotalRecord/recordPerPage;if(TotalRecord%recordPerPage>0){page+=1;}
$('#headerHistoryPagingVqmm').pager({pagenumber:currPage,pagecount:page,buttonClickCallback:function(page){spinLucky.BindHistoryLuckySpinList(page,15);}});}});}
this.closeCaptcha=function(){$("#popupCaptchaSpin").html("");}
function getAjaxInfo(url,callback){$.ajax({type:"GET",url:url,cache:false,crossDomain:true,xhrFields:{withCredentials:true},success:function(response){if(callback!=undefined&&typeof callback==="function")
callback(response);}});}
function postAjaxInfo(url,data,showLoading,callback){if(showLoading>0){Utils.showLoading();}
$.ajax({type:"POST",url:url,data:data,cache:false,crossDomain:true,xhrFields:{withCredentials:true},success:function(response){if(callback!=undefined&&typeof callback==="function")
callback(response);}}).always(function(){if(showLoading>0){Utils.hideLoading();}});}
function showPopupData(dataView,isOverlay,hideLoading,callback){if(!hideLoading>0){Utils.showLoading();}
$.ajax({type:"GET",url:configHeader.urlConfig.headerUrl+dataView,crossDomain:true,xhrFields:{withCredentials:true},success:function(html){showHtmlPopup(html,isOverlay);if(callback!=undefined&&typeof callback==="function")
callback();}}).always(function(){Utils.hideLoading();});}
function showHtmlPopup(html,isOverlay){if(isOverlay==undefined){isOverlay=1;}
if(isOverlay>0){Utils.showOverlayPopup("");}
$("#popupCaptchaSpin").html(html);}
this.ConfigSpin={Gold:[{id:1,position:5,val:0,name:'Trượt'},{id:2,position:7,val:100,name:'100 VGold'},{id:3,position:9,val:200,name:'200 VGold'},{id:4,position:11,val:500,name:'500 VGold'},{id:5,position:1,val:1000,name:'1k Gold'},{id:6,position:3,val:5000,name:'5k Gold'},{id:7,position:4,val:10000,name:'10k Gold'},{id:8,position:2,val:20000,name:'20k Gold'},{id:9,position:0,val:50000,name:'50k Gold'},{id:10,position:10,val:100000,name:'100k Gold'},{id:11,position:8,val:200000,name:'200k Gold'},{id:12,position:6,val:500000,name:'500k Gold'}],Coin:[{id:1,position:2,val:0,name:'Trượt'},{id:2,position:3,val:20000,name:'20K Xu'},{id:3,position:0,val:50000,name:'50K Xu'},{id:4,position:5,val:100000,name:'100K Xu'},{id:5,position:7,val:200000,name:'200K Xu'},{id:6,position:9,val:500000,name:'500K Xu'},{id:7,position:8,val:1000000,name:'1M Xu'},{id:8,position:11,val:2000000,name:'2M Xu'},{id:9,position:4,val:5,name:'5 Luot Quay Vua Phát Tài'},{id:10,position:10,val:10,name:'10 Luot Quay Vua Phát Tài'},{id:11,position:6,val:5,name:'5 Luot Quay Avenger'},{id:12,position:1,val:10,name:'10 Luot Quay Avenger'}]};}