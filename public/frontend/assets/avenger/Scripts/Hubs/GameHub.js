(function(scope,$){var intervalPingPong=null;var GameHub=function(hub){hub.server={};hub.client={};$.extend(hub.server,{PingPong:function(){return hub.invoke.apply(hub,$.merge(["PingPong"],$.makeArray(arguments)));},PlayTry:function(isTry){return hub.invoke.apply(hub,$.merge(["PlayTry"],$.makeArray(arguments)));},PlayNow:function(){return hub.invoke.apply(hub,$.merge(["PlayNow"],$.makeArray(arguments)));},ChangeRoom:function(betValue){return hub.invoke.apply(hub,$.merge(["ChangeRoom"],$.makeArray(arguments)));},Spin:function(betValue){return hub.invoke.apply(hub,$.merge(["Spin"],$.makeArray(arguments)));},GetX2Game:function(){return hub.invoke.apply(hub,$.merge(["GetX2Game"],$.makeArray(arguments)));},PlayX2Game:function(itemId){return hub.invoke.apply(hub,$.merge(["PlayX2Game"],$.makeArray(arguments)));},StopX2Game:function(){return hub.invoke.apply(hub,$.merge(["StopX2Game"],$.makeArray(arguments)));},GetBonusGame:function(){return hub.invoke.apply(hub,$.merge(["GetBonusGame"],$.makeArray(arguments)));},PlayBonusGame:function(itemid){return hub.invoke.apply(hub,$.merge(["PlayBonusGame"],$.makeArray(arguments)));},FinishBonus:function(){return hub.invoke.apply(hub,$.merge(["FinishBonus"],$.makeArray(arguments)));},SetAutoSpin:function(isAutoSpin,totalAutoSpins,betValue,autoSpinByServer,stopAutoConditions){return hub.invoke.apply(hub,$.merge(["SetAutoSpin"],$.makeArray(arguments)));}});hub.on('joinGame',function(player){console.log('JoinGame: ',player);App.Game.JoinGame(player);if(intervalPingPong){clearInterval(intervalPingPong);}
intervalPingPong=setInterval(function(){App.gameHub.server.PingPong();},5000);});hub.on('playerLeave',function(accountId){});hub.on("resultSpin",function(data){console.log("Spin: ",data);if(App.Game){App.Game.ResultSpin(data);}});hub.on("message",function(result,time){console.log('hub message:',result);if(result.indexOf("thiết bị")>0){GuiContents.ShowPopup(result,time);if(timeoutSpin){clearTimeout(timeoutSpin);}
Config.CurrentState=0;GuiContents.BindEvents();return;}
if(result.indexOf("Bạn không đủ tiền trong tài khoản")>=0||result.indexOf("Bạn không đủ Sao trong tài khoản")>=0){GuiContents.ShowPopup(result,null,1);Config.CurrentState=0;if(Config.IsAutoSpin){App.gameHub.server.SetAutoSpin(false,0,0,false,null);Config.TotalAutoSpin=0;Config.IsAutoSpin=false;GuiContents.UpdateAutoSpin(Config.TotalAutoSpin);}
GuiContents.BindEvents();return;}
if(result.indexOf("hệ thống đã tự động đóng băng")>=0){setTimeout(function(){var fixResult=result.replace('tại đây','<a id="btnSmsPlus" onclick="GuiContents.HidePopup()" href="javascript:;">tại đây</a>');GuiContents.ShowPopup(fixResult);Config.CurrentState=0;if(Config.IsAutoSpin){App.gameHub.server.SetAutoSpin(false,0,0,false,null);Config.TotalAutoSpin=0;Config.IsAutoSpin=false;GuiContents.UpdateAutoSpin(Config.TotalAutoSpin);}
GuiContents.BindEvents();},5000);return;}
if(result.indexOf("Error-48")>=0){var fixResult='Game Chúa Đảo 2 đang bị khóa. Hãy mở khóa để tiếp tục chơi<br/>Click vào <a id="btnGameBlock" onclick="GuiContents.HidePopup()" href="javascript:;">đây</a> để mở khóa';GuiContents.ShowPopup(fixResult);Config.CurrentState=0;GuiContents.BindEvents();return;}
GuiContents.ShowPopup(result,time);});hub.on('GetBonusResult',function(data){console.log("GetBonus:",data);if(data.BonusTurnID>0){GuiContents.ShowBonusGame(data);}});hub.on('resultBonusGame',function(data){console.log("PlayBonus:",data);if(data){App.Bonus.ResultPlayBonus(data);}});hub.on('resultFinishBonusGame',function(data){console.log("FinishBonus:",data);if(data&&App.Bonus){App.Bonus.ResultFinishBonus(data);}});hub.on('resultX2Game',function(data){console.log('X2 Game:',data);App.Double.ResultPlayX2(data);});hub.on('updateJackpot',function(jackpots){if(jackpots&&(!App.CD2AccInfo||!App.CD2AccInfo.IsPlayTry)){setTimeout(jackpots.forEach(function(jackpot){if(jackpot.RoomID===Config.RoomId){App.Game.UpdateJackpot(jackpot.JackpotFund);if(App.Bonus){App.Bonus.UpdateBonusJackpot(jackpot.JackpotFund);}}
App.Game.UpdateJackpotHunter(jackpot.JackpotFund,jackpot.RoomID);}),50);}});hub.on('notifyEvent',function(event){});hub.on('UpdatePlayingBonus',function(players){GuiContents.UpdateJackpotHunter(players);});hub.on('UpdateHonor',function(honor){GuiContents.UpdateHonor(honor);});};scope.GameHub=GameHub;})(window,$);