(function(scope,$){scope.Matrix={};var slotMatrix=function(){this.initMatrix();}
slotMatrix.prototype=new createjs.Container();slotMatrix.prototype.initMatrix=function(){slotMatrix.prototype.initialize();this.set({name:'PortalMatrix'});var itemXPos=[42+(160)*0,42+(160)*1,42+(160)*2,42+(160)*3,42+(160)*4];for(var i=0;i<itemXPos.length;i++){var container=new createjs.Container();container.set({'name':'container'+i,x:itemXPos[i],zindex:1});if(i>0&&i<4){var mask=new createjs.Shape();mask.graphics.drawRect(0,6,1000,1000);container.mask=mask;}
this.addChild(container);}};slotMatrix.prototype.DrawSlotItem=function(slotArray){var nameArray=convertSlotToImageName(slotArray);for(var row=0;row<3;row++){for(var col=0;col<5;col++){var imageName=nameArray[col][row];if(imageName==='')continue;var icon=Common.GetImageSpriteSheet(App.gameResources.getResourceItem('spritesheet.AllIcons'),imageName);var bound=icon.getBounds();icon.set({x:bound.width/2*0.5,y:bound.height/2*0.5+45+row*160,regX:bound.width/2,regY:bound.height/2,name:imageName});if(imageName.indexOf('icon1-2')>-1){icon.y+=40;}
if(imageName.indexOf('icon1-3')>-1){icon.y+=80;}
this.children[col].addChild(icon);}}}
slotMatrix.prototype.SpinAnimation=function(slotArray,callback){var that=this;for(var row=0;row<3;row++){for(var col=0;col<5;col++){var imageName="icon"+slotArray[col][row];var icon=Common.GetImageSpriteSheet(App.gameResources.getResourceItem('spritesheet.AllIcons'),imageName);var bound=icon.getBounds();icon.set({x:bound.width/2*0.5,y:-bound.height/2*0.5-45-(2-row)*160,regX:bound.width/2,regY:bound.height/2,name:imageName});this.children[col].addChild(icon);}}
that.rendingBox(callback);Config.CurrentState=2;GuiContents.UnbindEvents();}
slotMatrix.prototype.rendingBox=function(callback){var n={0:{x:0,t:10},1:{x:1,t:100},2:{x:2,t:200},3:{x:3,t:300},4:{x:4,t:400}};for(var x=0;x<5;x++)
this.downing(n[x].x,n[x].t,callback);}
slotMatrix.prototype.downing=function(i,t,callback){var itemIndex=[2,1,0,5,4,3];var container=this.children[i];if(container!=undefined&&container.children.length>0){var lengthChild=container.children.length;if(lengthChild==5){itemIndex=[1,0,4,3,2];}
if(lengthChild==4){itemIndex=[0,3,2,1];}
var k=0;var delayOneItem=300;while(k<lengthChild){if(k>=6){break;;}
var item=container.children[itemIndex[k]];if(item!=undefined){var y=item.y+487;var timeWait=t+delayOneItem*k;var timeRun=500;if(lengthChild==6&&k<3){y+=100}
if(lengthChild==5&&k<2){y+=100}
if(lengthChild==4&&k<1){y+=100}
if(i==4&&k==(itemIndex.length-1)){setTimeout(function(){if(callback)
callback();},timeWait+timeRun+200);}
createjs.Tween.get(item,{override:true}).wait(timeWait).to({y:y},timeRun,createjs.Ease.bounceOut);k++;}else{break;}}}};slotMatrix.prototype.DrawSlotItemEffect=function(slotArray){var nameArray=convertSlotToImageName(slotArray);for(var row=0;row<3;row++){for(var col=0;col<5;col++){var imageName=nameArray[col][row];if(imageName!='icon1-2'&&imageName!='icon1-3')continue;var icon=Common.GetImageSpriteSheet(App.gameResources.getResourceItem('spritesheet.AllIcons'),imageName);var bound=icon.getBounds();icon.set({x:bound.width/2*0.5,y:bound.height/2*0.5+45+row*160,regX:bound.width/2,regY:bound.height/2,name:imageName,alpha:0});if(imageName.indexOf('icon1-2')>-1){icon.y+=40;}
if(imageName.indexOf('icon1-3')>-1){icon.y+=80;}
$.each(this.children[col].children,function(key,value){if(value!=undefined&&value.name==="icon1"){value.parent.removeChild(value);}});$.each(this.children[col].children,function(key,value){if(value!=undefined&&value.name==="icon1"){value.parent.removeChild(value);}});$.each(this.children[col].children,function(key,value){if(value!=undefined&&value.name==="icon1"){value.parent.removeChild(value);}});if(imageName.indexOf('icon1-2')>-1){var effect2=Common.GetSprite(App.gameResources.getResourceItem('spritesheet.X2Span'),"Xpan2");var bounde2=effect2.getBounds();effect2.set({x:bounde2.width/2*0.5,y:bounde2.height/2*0.5+45+row*160,regX:bounde2.width/2,regY:bounde2.height/2,name:"Xpan2"});effect2.y+=33;effect2.x-=3;effect2.on("animationend",function(target){var parent=target.target.parent;parent.removeChild(target.currentTarget);$.each(parent.children,function(key,value){value.alpha=1;});});this.children[col].addChild(icon,effect2);}else if(imageName.indexOf('icon1-3')>-1){var effect3=Common.GetSprite(App.gameResources.getResourceItem('spritesheet.X3Span'),"Xpan3");var bounde3=effect3.getBounds();effect3.set({x:bounde3.width/2*0.5,y:bounde3.height/2*0.5+45+row*160,regX:bounde3.width/2,regY:bounde3.height/2,name:"Xpan3"});effect3.y+=80;effect3.on("animationend",function(target){var parent=target.target.parent;parent.removeChild(target.currentTarget);$.each(parent.children,function(key,value){value.alpha=1;});});this.children[col].addChild(icon,effect3);}}}}
var convertSlotToImageName=function(slotArray){return slotArray.map(function(col){var startIndex=-1;var numberItem=0;col.forEach(function(cell,i){if(cell===1){startIndex=startIndex===-1?i:startIndex;numberItem++;}else{if(i==1)numberItem--;}});var returnCol=JSON.parse(JSON.stringify(col));if(numberItem>1&&(startIndex!==-1&&startIndex!==2)){for(var i=0;i<3;i++){if(i==startIndex){returnCol[i]='1-'+numberItem;}else if(i>startIndex&&i<startIndex+numberItem){returnCol[i]=0;}}}
for(var i=0;i<3;i++){switch(returnCol[i]){case 0:returnCol[i]='';break;case 1:returnCol[i]='icon1-1';break;case '1-2':returnCol[i]='icon1-2';break;case '1-3':returnCol[i]='icon1-3';break;default:returnCol[i]='icon'+returnCol[i];break;};}
return returnCol;});}
scope.Matrix=slotMatrix;})(window,jQuery);